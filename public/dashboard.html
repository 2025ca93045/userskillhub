<h2>User Dashboard</h2>
<pre id="me"></pre>

<h3>Users</h3>
<ul id="users"></ul>

<h3>Courses</h3>
<ul id="courses"></ul>

<h3>My Sessions</h3>
<ul id="sessions"></ul>

<script>
async function load() {
  // Display student info
  const me = await fetch("/me").then(r => r.json());
  document.getElementById("me").textContent = JSON.stringify(me, null, 2);

  // Display all users
  const users = await fetch("/users").then(r => r.json());
  const usersList = document.getElementById("users");
  usersList.innerHTML = "";
  users.forEach(u => usersList.innerHTML += `<li>${u.email} (${u.role})</li>`);

  // Display all courses with request buttons
  const courses = await fetch("/courses").then(r => r.json());
  const coursesList = document.getElementById("courses");
  coursesList.innerHTML = "";
  courses.forEach(c => {
    coursesList.innerHTML += `
      <li>
        ${c.title} - ${c.instructor} 
        <button onclick="requestCourse(${c.id})">Request</button>
      </li>`;
  });

  // Load student sessions
  loadSessions();
}

// Fetch and display student's requested/upcoming sessions
async function loadSessions() {
  const sessions = await fetch("/student-sessions").then(r => r.json());
  const sessionsList = document.getElementById("sessions");
  sessionsList.innerHTML = "";
  sessions.forEach(s => {
    sessionsList.innerHTML += `<li>${s.title} [${s.status}]</li>`;
  });
}

// Request a new course session
async function requestCourse(courseId) {
  await fetch("/request", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ course_id: courseId })
  });

  // Reload sessions immediately
  loadSessions();
}

// Initial load
load();
</script>

